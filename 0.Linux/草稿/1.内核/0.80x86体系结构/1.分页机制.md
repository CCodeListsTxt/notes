#### 简介

* 分页机制是80x86内存管理机制的第二部分，其在分段机制的基础上完成线性地址到物理地址的转换过程。

  通过控制寄存器`CR0`的`PG`位可以设置是否开启分页机制。当禁止分页机制时，此时线性地址即为物理地址。

* 与分段机制不同，分页机制对固定大小的内存块进行操作。分页机制将线性地址空间和物理地址空间都划分成等大的页面，并进行映射。

  80x86使用固定的4KB大小的页面，并且对齐4KB边界处。这些页面既可以映射到内存空间，又可以映射到磁盘存储空间中。

---

#### 页表

* 页表存放在内存中，负责提供分页转换。

  可简单将页表视为存放2^20^个物理地址的数组，线性地址的高20位负责这个数组中的索引，低12位提供页面中的偏移量。

* 页表拥有2^20^个表项，每个表项占用4Byte空间，因此一个页表最多将占用4MB内存。为了降低页表内存占用，80x86使用两级页表：

  * 第一级称为页目录，长度为一个页面，具有2^10^个表项，每个表项指向一个页表。线性地址的高10位作为索引从页目录中选择其对应的页表。`CR3`寄存器指向页目录。
  * 第二季称为页表，长度为一个页面，最多含有2^10^个表项。线性地址的中间10位作为表项索引从页表中选择对应的表项，低12位提供页面中的偏移量。

  ![image-20221122192023208](../../../999.asset/image-20221122192023208.png)

  使用两级页表，并没有解决最多占用4MB内存以存放页表的问题，只是使用二级页表后，可以将页表分散存放在内存的各个页面中，且不需要为不存在或未使用的空间分配页表，这使得页表的占用的内存大多数情况下都小于4MB。

* 页表项格式。
  ![	](../../../999.asset/image-20221122194354324.png)
  
  * P，存在标志位。`P=0，页表无效，剩余的位可由程序自由使用`；`P=1，页表有效`。
  * R/W，读写标志位。`R/W = 1，页面可读、写、执行`；`R/W = 0，页面只读或可执行`。当处理器运行在`0、1或2`级别时，R/W标志位无效。
  * U/S，用户标志位。`U/S = 1，运行在任何特权级上的程序都可访问该页面`；`U/S = 0，只有运行在0、1或2权限级上的程序可访问`。
  * A，当处理器访问过该页面时，将其置为1。
  * D，当处理器修改过该页面时，将其置为1。
  
  

